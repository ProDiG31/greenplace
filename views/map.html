<!DOCTYPE html>
<html>

<head>
	<script src="/js/jquery-3.2.1.min.js"></script>
	<link rel="stylesheet" href="/css/bootstrap.min.css">

	<style>
		#map {
			height: 400px;
			width: 100%;
		}

	</style>

</head>

<body>
	<!-- As a heading -->
	<header class="navbar navbar-expand flex-column flex-md-row">
		<a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="Bootstrap">
  			<img src="/data/deciduous-tree.png" width="30" height="30" class="d-inline-block align-top" alt=""> <title>Green Place</title></img>
		</a> Green Place
		<div class="navbar-nav-scroll">
			<ul class="navbar-nav bd-navbar-nav flex-row">
				<li class="nav-item">
					<a class="nav-link" href="/">Home</a>
				</li>
			</ul>
		</div>
	</header>


	<div id="map"></div>
	<script>
		function initMap() {

			var uluru = {
				lat: 43.624984999999995,
				lng: 1.4319346
			};
			var map = new google.maps.Map(document.getElementById('map'), {
				zoom: 12,
				center: uluru
			});

			$.getJSON("/data", function(data) {
					$.each(data, function(key, val) {

							var contentString = '<div id="content">' +
								'<div id="siteNotice">' +
								'</div>' +
								'<h1 id="firstHeading" class="firstHeading">' + val.fields.patrimoine + '</h1>' +
								'<div id="bodyContent">' +
								'<p><b>Location : </b>' + val.fields.adresse + '</p>' +
								'<p><b> Recorded : </b>' + val.record_timestamp + '</p>' +
								'<p><b> Coordinate : </b>' + '[' + val.geometry.coordinates[1] + ',' + val.geometry.coordinates[0] + ']' + '</p>' +
								'</div>' +
								'</div>';

							var infowindow = new google.maps.InfoWindow({
								content: contentString
							});

							var imageTree = "/data/deciduous-tree.png";
							//					 	var imageIcon = "https://png.icons8.com/color/50/000000/deciduous-tree.png";

							if (val.fields.geo_shape.type == "LineString") {

								let flightPlanCoordinates = [];
								let coordinate = json.parse(val.fields.geo_shape.coordinates);
								
								for (Object o : coordinate ) {
									if (o instanceof JSONObject) {
										//								parse((JSONObject) o);
										flightPlanCoordinates += {
											lat: o[1],
											lng: o[0]
										}
									}
								} 
									console.log("FLiGPS = " + flightPlanCoordinates);
									
									var flightPath = new google.maps.Polyline({
										path: flightPlanCoordinates,
										geodesic: true,
										strokeColor: '#FF0000',
										strokeOpacity: 1.0,
										strokeWeight: 2
									});

									flightPath.setMap(map);

									//						let treeStart = {
									//							lat: val.geometry.coordinates[1],
									//							lng: val.geometry.coordinates[0]
									//						};
									//
									//						var marker = new google.maps.Marker({
									//							position: treeStart,
									//							map: map,
									//							icon: imageTree
									//						});

								} else if (val.fields.geo_shape.type == "MultiLineString") {

									let treeStart = {
										lat: val.geometry.coordinates[1],
										lng: val.geometry.coordinates[0]
									};

									var marker = new google.maps.Marker({
										position: treeStart,
										map: map,
									});

								}
								//						
								//					} else {
								//						console.log("[ERROR] - "+val.fields.geo_shape.type); 
								//					}
								//					marker.addListener('click', function() {
								//						infowindow.open(map, marker);
								//					});
							});
					});
			}

	</script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDrmAKRosfqSjSXvy2aLhZC7yyhVZ66JAs&callback=initMap">


	</script>

	<!--

	<script>
		$.getJSON("/data", function(data) {
			console.log(data);

			var items = [];
			$.each(data, function(key, val) {
				items.push("<li id='" + key + "'>" + val.fields.patrimoine + "</li>");
			});

			$("<ul/>", {
				"class": "my-new-list",
				html: items.join("")
			}).appendTo("body");
			console.log(items);
		});

	</script>
-->

	<script src="/js/popper.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
</body>

</html>
